digraph eDNA_Pipeline {
    // Graph attributes for square layout
    graph [rankdir=TB, splines=polyline, nodesep=0.6, ranksep=0.7, fontsize=20, fontname="Arial"]
    node [shape=box, style=filled, fontsize=16, width=2.2, height=1.0, fontname="Arial"]
    edge [color=gray50, penwidth=2, fontname="Arial"]

    // Row 1: Sample Collection & Processing (4 boxes) - Blue group
    sample_collection [label="Sample\nCollection", fillcolor=lightblue]
    edna_extraction [label="DNA Extraction\n& Sequencing", fillcolor=lightblue]
    data_preprocessing [label="Data Quality\nControl", fillcolor=lightblue]
    feature_engineering [label="Sequence Pattern\nAnalysis", fillcolor=lightgreen]

    // Row 2: Data Analysis (3 boxes) - Green group
    unsupervised_learning [label="Data\nClustering", fillcolor=lightgreen]
    reference_free_classification [label="Species\nIdentification", fillcolor=lightgreen]
    abundance_quantification [label="Species Count\nEstimation", fillcolor=orange]

    // Row 3: Results & Validation (4 boxes) - Orange/Pink group
    confidence_scoring [label="Result Validation\n& Scoring", fillcolor=orange]
    validation [label="New Species\nDetection", fillcolor=lightpink]
    biodiversity_analysis [label="Biodiversity\nAssessment", fillcolor=lightpink]
    monitoring_dashboard [label="Data\nVisualization", fillcolor=lightpink]

    // Row 4: Management & Output (3 boxes) - Yellow group
    conservation_output [label="Conservation\nRecommendations", fillcolor=lavender]
    temporal_analysis [label="Trend\nAnalysis", fillcolor=lavender]
    adaptive_sampling [label="Sampling\nOptimization", fillcolor=lavender]

    // Main workflow connections
    sample_collection -> edna_extraction
    edna_extraction -> data_preprocessing
    data_preprocessing -> feature_engineering
    feature_engineering -> reference_free_classification
    feature_engineering -> unsupervised_learning
    reference_free_classification -> abundance_quantification
    unsupervised_learning -> abundance_quantification
    abundance_quantification -> confidence_scoring
    confidence_scoring -> validation
    validation -> biodiversity_analysis
    biodiversity_analysis -> monitoring_dashboard
    monitoring_dashboard -> conservation_output
    monitoring_dashboard -> temporal_analysis
    
    // Feedback loops
    validation -> unsupervised_learning [style=dashed, color=red, xlabel="Model Updates" fontsize=14]
    temporal_analysis -> adaptive_sampling [color=blue]
    adaptive_sampling -> sample_collection [style=dashed, color=blue, xlabel="Feedback Loop" fontsize=14]

    // Rank constraints for cleaner layout (3-3-3-3-2)
    {rank=same; sample_collection, edna_extraction, data_preprocessing}
    {rank=same; feature_engineering, unsupervised_learning, reference_free_classification}
    {rank=same; abundance_quantification, confidence_scoring, validation}
    {rank=same; biodiversity_analysis, monitoring_dashboard, conservation_output}
    {rank=same; temporal_analysis, adaptive_sampling}
}